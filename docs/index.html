<!DOCTYPE html>
<!--
 Copyright 2025 acyumi <417064257@qq.com>

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Coverage Reports Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #6c63ff;
      --secondary-color: #4a45b1;
      --light-color: #f8f9fa;
      --dark-color: #343a40;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f5f7fa;
      color: #333;
    }

    .header {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      padding: 2rem 0;
      margin-bottom: 2rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .card {
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
      margin-bottom: 20px;
      border: none;
    }

    .card:hover {
      transform: translateY(-5px);
    }

    .card-header {
      background-color: var(--primary-color);
      color: white;
      border-radius: 10px 10px 0 0 !important;
      font-weight: 600;
    }

    .badge-success {
      background-color: #28a745;
    }

    .badge-warning {
      background-color: #ffc107;
    }

    .badge-danger {
      background-color: #dc3545;
    }

    .report-link {
      color: var(--primary-color);
      text-decoration: none;
      font-weight: 500;
    }

    .report-link:hover {
      text-decoration: underline;
      color: var(--secondary-color);
    }

    .job-link {
      color: #6c757d;
      font-size: 0.9rem;
    }

    .empty-state {
      text-align: center;
      padding: 3rem;
      color: #6c757d;
    }

    .empty-state i {
      font-size: 3rem;
      color: #dee2e6;
      margin-bottom: 1rem;
    }

    footer {
      background-color: var(--dark-color);
      color: white;
      padding: 1.5rem 0;
      margin-top: 3rem;
    }

    @media (max-width: 768px) {
      .header h1 {
        font-size: 1.8rem;
      }
    }
  </style>
</head>
<body>
<div class="header">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-8">
        <h1><i class="fas fa-chart-pie me-2"></i>Test Coverage Reports</h1>
        <p class="mb-0">Historical test coverage reports generated by GitHub Actions</p>
      </div>
      <div class="col-md-4 text-md-end">
        <a href="https://github.com/acyumi/xdoc/actions" class="btn btn-outline-light">
          <i class="fab fa-github me-1"></i> View Workflow Runs
        </a>
      </div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row mb-4">
    <div class="col-12">
      <div class="alert alert-info">
        <i class="fas fa-info-circle me-2"></i>
        This page automatically lists all coverage reports generated by CI/CD pipelines.
        Click on any report to view detailed coverage analysis.
      </div>
    </div>
  </div>

  <div class="row" id="reports-container">
    <!-- Reports will be dynamically inserted here -->
  </div>

  <div class="row d-none" id="empty-state">
    <div class="col-12">
      <div class="empty-state">
        <i class="fas fa-folder-open"></i>
        <h3>No Coverage Reports Found</h3>
        <p>No coverage reports have been generated yet. Check back after your next CI/CD run.</p>
      </div>
    </div>
  </div>
</div>

<footer>
  <div class="container text-center">
    <p class="mb-0">Generated on <span id="current-date"></span> • <a href="https://github.com/acyumi/xdoc" class="text-white">View Repository</a></p>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Set current date in footer
    const now = new Date();
    document.getElementById('current-date').textContent = now.toLocaleDateString('en-US', {
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });

    // Fetch and display coverage reports
    fetchCoverageReports();
  });

  async function fetchCoverageReports() {
    // Get all coverage report files
    const response = await fetch('coverage_reports.json'); // 从当前目录读取JSON文件
    const reports = await response.json();

    // Sort by date (newest first)
    reports.sort((a, b) => b.date - a.date);

    // Display reports
    const container = document.getElementById('reports-container');
    const emptyState = document.getElementById('empty-state');

    if (reports.length === 0) {
      container.classList.add('d-none');
      emptyState.classList.remove('d-none');
      return;
    }

    container.classList.remove('d-none');
    emptyState.classList.add('d-none');

    reports.forEach(report => {
      const coverageClass = report.coverage >= 90 ? 'badge-success' :
              report.coverage >= 85 ? 'badge-warning' : 'badge-danger';

      const card = document.createElement('div');
      card.className = 'col-md-6 col-lg-4';
      card.innerHTML = `
                    <div class="card h-110">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span>Run #${report.runId}</span>
                            <span class="badge ${coverageClass}">${report.coverage}%</span>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Coverage Report</h5>
                            <p class="card-text">
                                <i class="far fa-calendar-alt me-1"></i>
                                ${report.date}
                            </p>
                            <div class="d-flex justify-content-between align-items-center">
                                <a href="${report.fileName}" class="report-link">
                                    <i class="fas fa-external-link-alt me-1"></i> View Report
                                </a>
                                <a href="https://github.com/acyumi/xdoc/actions/runs/${report.runId}/job/${report.jobId}"
                                   class="job-link" target="_blank" title="View Job">
                                    <i class="fas fa-link"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                `;

      container.appendChild(card);
    });
  }
</script>
</body>
</html>